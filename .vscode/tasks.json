{
  "version": "2.0.0",
  "tasks": [
    {
      "label": "RLC: List Tasks",
      "type": "shell",
      "command": "bash",
      "args": ["-c", "cd /home/ing/RICK/RICK_LIVE_CLEAN && python3 << 'PYEOF'\nimport json\nj = json.load(open('.vscode/tasks.json'))\nprint('\\n=== STATUS: Task Catalog ===')\nprint('\\nAvailable RLC tasks:\\n')\nfor t in j.get('tasks',[]):\n  lab = t.get('label','')\n  if lab.startswith('RLC: '):\n    det = t.get('detail','')\n    print(f'  â€¢ {lab}')\n    print(f'    {det}\\n')\nprint('--- ACTION: Task catalog listed ---')\nPYEOF"],
      "presentation": { "reveal": "always", "panel": "dedicated" },
      "detail": "List all available RLC tasks with descriptions."
    },
    {
      "label": "RLC: Ping / Status Audit",
      "type": "shell",
      "command": "bash",
      "args": ["-c", "cd /home/ing/RICK/RICK_LIVE_CLEAN && set -a && . ./.env && set +a 2>/dev/null; echo '=== STATUS: SYSTEM HEALTH CHECK ===' && echo '' && echo '[ğŸ¤– Engine]' && (pgrep -af 'oanda_trading_engine.py' && echo '  âœ… Running' || echo '  â¸ï¸  Stopped') && echo '' && echo '[ğŸšª Connector Gates]' && (grep -q 'EXPECTED_PNL_BELOW_MIN' brokers/oanda_connector.py && echo '  âœ… TP-PnL floor active' || echo '  âŒ Missing') && (grep -q 'MIN_NOTIONAL' brokers/oanda_connector.py && echo '  âœ… Notional floor active' || echo '  âŒ Missing') && echo '' && echo '[ğŸš¨ Position Police]' && (grep -q '_rbz_force_min_notional_position_police' oanda_trading_engine.py && echo '  âœ… Armed' || echo '  âŒ Missing') && echo '' && echo '[ğŸ“‹ Charter Constants]' && python3 - <<'PYEOF'\ntry:\n  from foundation.rick_charter import RickCharter\n  mn = getattr(RickCharter, 'MIN_NOTIONAL_USD', '?')\n  mp = getattr(RickCharter, 'MIN_EXPECTED_PNL_USD', '?')\n  print(f'  foundation: MIN_NOTIONAL=${mn}, MIN_PNL=${mp}')\nexcept:\n  print('  foundation: unavailable')\ntry:\n  from rick_charter import RickCharter\n  mn = getattr(RickCharter, 'MIN_NOTIONAL_USD', '?')\n  mp = getattr(RickCharter, 'MIN_EXPECTED_PNL_USD', '?')\n  print(f'  root: MIN_NOTIONAL=${mn}, MIN_PNL=${mp}')\nexcept:\n  print('  root: unavailable')\nPYEOF\necho '' && echo '[ğŸ”‘ OANDA Credentials]' && ([ -n \"$OANDA_PRACTICE_ACCOUNT_ID\" ] && echo \"  âœ… ACCOUNT: $OANDA_PRACTICE_ACCOUNT_ID\" || echo '  âŒ ACCOUNT_ID missing') && ([ -n \"$OANDA_PRACTICE_TOKEN\" ] && echo \"  âœ… TOKEN: ${OANDA_PRACTICE_TOKEN:0:16}...\" || echo '  âŒ TOKEN missing') && echo '' && echo '--- ACTION: Audit complete (all systems checked) ---'"],
      "presentation": { "reveal": "always", "panel": "dedicated" },
      "detail": "Full health check: engine, gates, Position Police, charter, OANDA credentials."
    },
    {
      "label": "RLC: Start STRICT Engine (practice)",
      "type": "shell",
      "command": "bash",
      "args": ["-c", "cd /home/ing/RICK/RICK_LIVE_CLEAN && set -a && . ./.env && set +a 2>/dev/null; echo '=== STATUS: STARTING OANDA PRACTICE ENGINE ===' && if pgrep -af 'oanda_trading_engine.py' >/dev/null 2>&1; then echo 'Engine already running'; echo '--- ACTION: No-op (already running) ---'; exit 0; fi && if [ -z \"$OANDA_PRACTICE_ACCOUNT_ID\" ] || [ -z \"$OANDA_PRACTICE_TOKEN\" ]; then echo 'âŒ OANDA credentials not loaded'; echo 'Run in terminal: cd /home/ing/RICK/RICK_LIVE_CLEAN && set -a && source .env && set +a'; echo '--- ACTION: Aborted (missing creds) ---'; exit 2; fi && echo \"Starting with ACCOUNT: $OANDA_PRACTICE_ACCOUNT_ID\" && (export OANDA_PRACTICE_ACCOUNT_ID OANDA_PRACTICE_TOKEN && setsid nohup python3 -u oanda_trading_engine.py >/dev/null 2>&1 &) && sleep 2 && (pgrep -af 'oanda_trading_engine.py' >/dev/null 2>&1 && echo 'âœ… Engine launched (background)' && echo '--- ACTION: Engine started successfully ---' || (echo 'âŒ Engine failed to start' && echo '--- ACTION: Failed ---' && exit 1))"],
      "presentation": { "reveal": "always", "panel": "dedicated" },
      "detail": "Start OANDA practice engine. Safe: no-ops if already running. Requires .env creds."
    },
    {
      "label": "RLC: Stop All (safe)",
      "type": "shell",
      "command": "bash",
      "args": ["-c", "cd /home/ing/RICK/RICK_LIVE_CLEAN && echo '=== STATUS: STOPPING ENGINE ===' && if pgrep -af 'oanda_trading_engine.py' >/dev/null 2>&1; then echo \"Found running engine\"; pkill -f 'oanda_trading_engine.py' || true; sleep 1; (pgrep -af 'oanda_trading_engine.py' >/dev/null && echo 'âš ï¸  Engine still running' || echo 'âœ… Engine stopped'); echo '--- ACTION: Stop attempted ---'; else echo 'â¸ï¸  No engine running'; echo '--- ACTION: No-op (nothing to stop) ---'; fi"],
      "presentation": { "reveal": "always", "panel": "dedicated" },
      "detail": "Safe stop. Idempotent: no error if engine already stopped."
    },
    {
      "label": "RLC: Sweep â€” Position Police",
      "type": "shell",
      "command": "bash",
      "args": ["-c", "cd /home/ing/RICK/RICK_LIVE_CLEAN && set -a && . ./.env && set +a 2>/dev/null; echo '=== STATUS: POSITION POLICE SWEEP (sub-$15k auto-close) ===' && python3 - <<'PYEOF'\ntry:\n  from oanda_trading_engine import _rbz_force_min_notional_position_police as sweep\n  print('Running sweep...')\n  sweep()\n  print('Sweep complete')\nexcept Exception as e:\n  print(f'ERROR: {e}')\nPYEOF\necho '' && echo '--- ACTION: Sweep executed (check for CHARTER_VIOLATION/FORCE_CLOSE above) ---'"],
      "presentation": { "reveal": "always", "panel": "dedicated" },
      "detail": "Force-check and close any live position under $15k notional. Requires .env creds."
    },
    {
      "label": "RLC: Tail Narration (pretty)",
      "type": "shell",
      "command": "bash",
      "args": ["-c", "cd /home/ing/RICK/RICK_LIVE_CLEAN && echo '=== STATUS: NARRATION MONITOR ===' && echo 'Press Ctrl+C to stop. Looking for:' && echo '  â€¢ CHARTER_VIOLATION' && echo '  â€¢ EXPECTED_PNL_BELOW_MIN' && echo '  â€¢ ORDER_REJECTED_MIN_NOTIONAL' && echo '  â€¢ POSITION_BELOW_MIN_NOTIONAL' && echo '' && (pgrep -af 'oanda_trading_engine.py' >/dev/null && echo 'âœ… Engine running' || echo 'âš ï¸  Engine not running') && echo '' && echo '--- ACTION: Attaching to narration stream (Ctrl+C to detach) ---' && ([ -f logs/narration.jsonl ] && tail -f logs/narration.jsonl || echo 'No narration log found yet (engine will create it)')"],
      "presentation": { "reveal": "always", "panel": "shared" },
      "detail": "Live tail of narration events. Shows violations, adaptive triggers, gate activity."
    },
    {
      "label": "RLC: Lock Critical Files",
      "type": "shell",
      "command": "bash",
      "args": ["-c", "cd /home/ing/RICK/RICK_LIVE_CLEAN && echo '=== STATUS: LOCKING CRITICAL FILES ===' && chmod a-w brokers/oanda_connector.py rick_charter.py oanda_trading_engine.py .vscode/tasks.json 2>/dev/null || true && echo 'Checking locks:' && ls -la brokers/oanda_connector.py rick_charter.py oanda_trading_engine.py .vscode/tasks.json 2>/dev/null | awk '{print $1, $9}' && echo '--- ACTION: Files locked read-only (idempotent) ---'"],
      "presentation": { "reveal": "always", "panel": "dedicated" },
      "detail": "Re-apply read-only locks to enforcement files. Prevents agent tampering."
    },
    {
      "label": "RLC: Show Guardrails",
      "type": "shell",
      "command": "bash",
      "args": ["-c", "echo '' && echo 'â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—' && echo 'â•‘         RLC GOVERNANCE CONTRACT (IMMUTABLE)                      â•‘' && echo 'â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•' && echo '' && echo 'ğŸ” AUTHORITY:' && echo '  â€¢ Agent may ONLY run tasks labeled \"RLC: *\"' && echo '  â€¢ Agent must REFUSE without suffix: approve 841921' && echo '' && echo 'ğŸš« FORBIDDEN:' && echo '  â€¢ Create, rename, move, or delete files/folders' && echo '  â€¢ Modify code or config (read-only operations only)' && echo '  â€¢ Use TA-Lib or external dependencies' && echo '  â€¢ Use live OANDA (practice only)' && echo '' && echo 'ğŸ“‹ PATTERN:' && echo '  â€¢ Before task: print STATUS (engine, gates, charter, creds)' && echo '  â€¢ After task: print ACTION (what was done)' && echo '  â€¢ All tasks: safe to re-run, no side effects' && echo '' && echo 'âœ… CREDENTIALS:' && echo '  â€¢ Load in terminal: set -a && . ./.env && set +a' && echo '  â€¢ If missing: instruct user to load before re-running' && echo '' && echo '--- ACTION: Governance rules displayed ---'"],
      "presentation": { "reveal": "always", "panel": "dedicated" },
      "detail": "Display immutable RLC governance contract and rules."
    }
  ]
}
